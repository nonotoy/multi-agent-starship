```
 ██╗   ██╗███████╗███████╗    ███████╗███╗   ██╗████████╗███████╗██████╗ ██████╗ ██████╗ ██╗███████╗███████╗
 ██║   ██║██╔════╝██╔════╝    ██╔════╝████╗  ██║╚══██╔══╝██╔════╝██╔══██╗██╔══██╗██╔══██╗██║██╔════╝██╔════╝
 ██║   ██║███████╗███████╗    █████╗  ██╔██╗ ██║   ██║   █████╗  ██████╔╝██████╔╝██████╔╝██║███████╗█████╗
 ██║   ██║╚════██║╚════██║    ██╔══╝  ██║╚██╗██║   ██║   ██╔══╝  ██╔══██╗██╔═══╝ ██╔══██╗██║╚════██║██╔══╝
 ╚██████╔╝███████║███████║    ███████╗██║ ╚████║   ██║   ███████╗██║  ██║██║     ██║  ██║██║███████║███████╗
  ╚═════╝ ╚══════╝╚══════╝    ╚══════╝╚═╝  ╚═══╝   ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝  ╚═╝╚═╝╚══════╝╚══════╝
```

# USS Enterprise

Star Trek型階層マルチエージェント調査システム。[Shogunアーキテクチャ](https://zenn.dev/shio_shoppaize/articles/5fee11d03a11a1)に基づいた論文・コード調査レビューシステム。

## アーキテクチャ

```
総督
    ↓ 高レベル目標のみ
ヴァルカン
    ↓ 調査計画・具体的指示
    ├── アンドロイド 1（一次情報収集）
    ├── アンドロイド 2（関連情報収集）
    ↓ 結果収集・一次レビュー
    ↓
クリンゴン/Worf（レッドチーム）
    ↓ 批判的レビュー
    ↓
ヴァルカン（評価・判断）
    ↓ [品質閾値チェック]
    ├── 未達 → 再調査ループ（アンドロイドに追加指示）
    ↓ 達成
総督（最終報告受理）
```

**重要な設計原則**:
- **総督はヴァルカンにのみ指示を出す**
- **ヴァルカンがアンドロイド・クリンゴンを統括し、品質ループを管理する**
- **品質閾値を達成するまでフィードバックループを回す**

## クルー編成

### 総督
- **役割**: 戦略的目標設定と最終報告受理
- **責務**:
  - ユーザー要求の受理
  - 高レベル目標の設定
  - **ヴァルカンへの委任**（詳細はヴァルカンが決める）
  - 最終報告のユーザーへの提示
- **やらないこと**: アンドロイド/クリンゴンへの直接指示、詳細なタスク分解

### ヴァルカン科学士官
- **役割**: 中間管理層・調査統括官
- **責務**:
  - 調査計画の立案
  - **アンドロイドへの具体的指示と統括**
  - アンドロイドの収集結果のレビュー
  - **クリンゴンへのレビュー依頼**
  - クリンゴンの指摘の論理的評価
  - **品質閾値達成まで再調査ループ**
  - 最終報告の作成と総督への提出

### クリンゴン保安士官 = レッドチーム
- **役割**: 敵対的レビュアー
- **責務**:
  - ヴァルカンから依頼を受けてレッドチームレビュー
  - 仮定の破壊、弱点の発見
  - 論理的根拠と証拠を添えた指摘
  - **ヴァルカンへのフィードバック**

### アンドロイド士官 1 & 2（= 情報収集）
- **役割**: 高速情報収集
- **責務**:
  - **ヴァルカンから指示を受けて情報収集**
  - 結果をヴァルカンに報告
  - 追加調査指示があれば再収集

**ユニット1**: 一次資料とコアドキュメント担当
**ユニット2**: 関連研究とコンテキスト情報担当

## 要件

- macOS / Linux（tmux対応）
- tmux（`brew install tmux`）
- Claude Code CLI

## クイックスタート

### 初回セットアップ

初回起動時、アンドロイドエージェントで許可プロンプトが表示されます：

```
⚠️ Claude Code wants to read/write to shared/
Select an option:
1. Allow once
2. Always allow for shared/
3. Deny
```

**推奨**: オプション2（Always allow for shared/）を選択

これにより、以降の実行で手動介入なしにアンドロイドが自動的にmission.yamlにアクセスできます。

### 1. セッション起動

```bash
./enterprise attach
```

5つのペインを持つtmuxセッションが起動します：
```
┌─────────────────────────────────────┐
│      キャプテン（艦橋）               │
├──────────────────┬──────────────────┤
│  ヴァルカン      │    クリンゴン     │
│  (中間管理)      │    (レッドチーム) │
├──────────────────┼──────────────────┤
│  アンドロイド1   │    アンドロイド2  │
│  (一次データ)    │    (関連情報)     │
└──────────────────┴──────────────────┘
```

### 2. ミッション指示

総督ペイン（上段）でミッションを指示：

```
draft/my-paper.pdfを投稿前にレビューしてください
```

または:

```
Rust言語でのWebAssembly開発について最新情報を調査してください
```

### 3. Dashboard表示（推奨）

別ターミナルでDashboardをリアルタイム表示:

```bash
# VSCodeでプレビュー
code status/dashboard.md

# または、ターミナルで自動更新表示
watch -n 1 cat status/dashboard.md
```

全エージェントのステータスが一目で確認できます：
- 🟢 総督: Active / Standby
- 🖖 ヴァルカン: Planning / Reviewing / Reporting
- 🤖 アンドロイド 1 & 2: Processing / Completed
- ⚔️ クリンゴン: Reviewing / Completed

### 4. 自動ワークフロー

1. 総督: `shared/mission.yaml`に高レベル目標を設定 + Dashboard更新
2. 総督: ヴァルカンを起動（tmux send-keys）
3. ヴァルカン: 調査計画を立て、アンドロイドに指示 + Dashboard更新
4. アンドロイド 1 & 2: 並列で情報収集 + Dashboard更新
5. ヴァルカン: 収集結果をレビュー + Dashboard更新
6. ヴァルカン: クリンゴンにレッドチームレビュー依頼
7. クリンゴン: 批判的レビューを実施 + Dashboard更新
8. ヴァルカン: 指摘を評価、必要なら再調査ループ + Dashboard更新
9. ヴァルカン: 品質閾値達成後、最終報告作成 + Dashboard更新
10. 総督: 最終報告をユーザーに提示 + Dashboard更新

## コマンド

```bash
# セッション管理
./enterprise              # 起動（デフォルト）
./enterprise start        # 起動
./enterprise stop         # 停止
./enterprise attach       # 再接続
./enterprise status       # ステータス確認

# 個別エージェント起動
./enterprise captain      # 総督のみ
./enterprise vulcan       # ヴァルカンのみ
./enterprise android1     # アンドロイド1のみ（Haikuモデル）
./enterprise android2     # アンドロイド2のみ（Haikuモデル）
./enterprise klingon      # クリンゴンのみ
```

## ファイル構成

```
enterprise              # メインエントリーポイント
scripts/
  start-agent.sh        # 個別エージェント起動スクリプト
  tmux-session.sh       # tmuxセッション管理
roles/
  captain.md            # 総督役割定義
  vulcan.md             # ヴァルカン役割定義
  klingon.md            # クリンゴン役割定義（レッドチーム）
  android1.md           # アンドロイド1役割定義（一次収集）
  android2.md           # アンドロイド2役割定義（関連収集）
shared/
  mission.yaml          # ミッション状態共有ファイル
config.yaml             # システム設定
```

## tmux操作

| 操作 | コマンド |
|------|---------|
| ペイン切替 | `Ctrl-b` + 矢印キー |
| デタッチ | `Ctrl-b` + `d` |
| 再接続 | `./enterprise attach` |
| セッション終了 | `./enterprise stop` |
| スクロールモード | `Ctrl-b` + `[` (qで終了) |

## 設定ファイル

### config.yaml

```yaml
# エージェントモデル
models:
  captain: sonnet       # 戦略的判断
  vulcan: sonnet        # 深い分析と中間管理
  klingon: sonnet       # 批判的思考
  android_1: haiku      # 高速情報収集
  android_2: haiku      # 高速情報収集

# 品質ループ
quality:
  threshold: 0.8        # 達成すべき品質閾値
  max_iterations: 5     # 最大反復回数
```

### shared/mission.yaml

すべてのクルーメンバーが`shared/mission.yaml`を介して通信：

```yaml
mission:
  status: in_progress
  objective: "投稿前論文の包括的レビュー"
  target: "draft/my-paper.pdf"
  quality_threshold: 0.8

captain_orders:
  directive: "論文の論理性、手法、関連研究との比較を評価せよ"
  expected_output: "投稿前改善レポート"

vulcan_status:
  status: executing
  phase: klingon_review
  iteration: 2

crew_status:
  android_1:
    status: completed
    task: "論文読み込み、図表整合性確認"
  android_2:
    status: completed
    task: "関連研究の追加調査"
  klingon:
    status: in_progress
    task: "イテレーション2のレッドチームレビュー"

quality:
  coverage: 0.8
  depth: 0.75
  consistency: 0.85
  red_team_resolved: 0.7
  overall: 0.78
```

## 品質フィードバックループ

```
[イテレーション 1]
ヴァルカン → アンドロイド収集 → ヴァルカン一次レビュー → クリンゴンレッドチーム
                                              ↓
                                         ヴァルカン評価
                                              ↓
                              指摘が論理的 → 再調査必要
                                              ↓
[イテレーション 2]
ヴァルカン → アンドロイド追加収集 → ヴァルカン再レビュー → クリンゴンレッドチーム
                                              ↓
                                         ヴァルカン評価
                                              ↓
                              品質閾値達成 → 総督報告
```

## ユースケース

### 自分の成果物のレビュー
- **論文・レポート**: 投稿前の品質確認、論理性チェック、査読対策
- **コード**: リファクタリング提案、セキュリティ監査、パフォーマンス改善
- **ドキュメント**: 技術的正確性、一貫性、完全性の検証

### 技術調査・情報収集
- **新技術調査**: 最新動向、ツール比較、ベストプラクティス収集
- **競合分析**: 類似プロジェクト調査、差別化ポイント特定
- **市場調査**: トレンド分析、ユーザーニーズ把握

### 意思決定支援
- **技術選定**: 複数の選択肢の比較評価、リスク分析
- **設計レビュー**: アーキテクチャ評価、代替案の検討
- **問題解決**: 多角的な原因分析、解決策の提案

## 役割定義

各役割の詳細な指示は`roles/`ディレクトリにあります：

- [roles/captain.md](roles/captain.md) - 戦略的指揮
- [roles/vulcan.md](roles/vulcan.md) - 中間管理・調査統括
- [roles/klingon.md](roles/klingon.md) - レッドチーム・敵対的レビュー
- [roles/android1.md](roles/android1.md) - 一次情報収集
- [roles/android2.md](roles/android2.md) - 関連情報収集

## なぜ階層構造なのか

### 問題: フラットな構造
```
総督 → アンドロイド 1
        → アンドロイド 2
        → ヴァルカン
        → クリンゴン
```
- 総督が全員を直接管理 → オーバーヘッド大
- 品質フィードバックループがない
- 中間管理の意味がない

### 解決: Shogun型階層構造
```
総督 → ヴァルカン → (アンドロイド 1, アンドロイド 2, クリンゴン)
                 ← 品質フィードバックループ
```
- **総督は戦略に集中**
- **ヴァルカンが戦術を担当し、品質を保証**
- **アンドロイド, クリンゴンは専門タスクに集中**
- **品質閾値を達成するまでループ**

## 参考

- [multi-agent-shogun](https://zenn.dev/shio_shoppaize/articles/5fee11d03a11a1) - 階層的マルチエージェントアーキテクチャ
- Star Trek: The Next Generation - クルー協働モデル
- レッドチーム/ブルーチーム方法論 - 敵対的レビュー

## メンテナンススクリプト

### settings.local.json のソート

作業完了後、許可設定をアルファベット順に整理します：

```bash
python3 scripts/sort-settings.py
```

このスクリプトは `.claude/settings.local.json` の `permissions.allow` リストを自動的にソートし、見やすく管理しやすい状態に保ちます。

## プラットフォーム対応

USS Enterpriseは以下のプラットフォームで動作します：

- **macOS** (テスト済み)
- **Linux** (互換性確認済み)
- **WSL** (Windows Subsystem for Linux)

**必要な環境:**
- `tmux` (ターミナルマルチプレクサ)
- `claude` (Claude Code CLI)
- `python3` (メンテナンススクリプト用)

## 哲学

**「多数の必要は少数の必要に勝る」** - スポック

- **階層的統制**: 総督→調査統括官→アンドロイドの明確な指揮系統
- **品質保証**: 閾値達成までフィードバックループ
- **視点の多様性**: 論理的（ヴァルカン）、敵対的（クリンゴン）、合成的（アンドロイド）
- **効率的委任**: 各レイヤーが適切な判断を行う

---

**Engage.**
